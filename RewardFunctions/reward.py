#using re:Invent 2018
#map reinvent:base (2018)

import math

def get_direction(initial_point, next_point):
    # Calculate the direction in radius, arctan2(dy, dx), the result is (-pi, pi) in radians
    direction = math.atan2(next_point[1] - initial_point[1], next_point[0] - initial_point[0])
    # Convert to degree
    direction = math.degrees(direction)
    return direction

def distance_between_points(point1, point2):
    x1, y1 = point1
    x2, y2 = point2
    return abs(abs(x1-x2)**2 + abs(y1-y2)**2)**0.5

def get_closest_waypoints(coords, point):
    #returns index of the closest 2 waypoints in a list of coords to a given point
    #[Previous, Next]
    index1 = 0
    distance = 20 #dumb large number so that it gets reassigned
    for i, coord in enumerate(coords):
        newDistance = distance_between_points(coord, point)
        if(newDistance < distance):
            index1 = i
            distance = newDistance
    distNext = distance_between_points(coords[(index1 + 1) % len(coords)], point)
    if(index1 != 0):
        distPrev = distance_between_points(coords[(index1 - 1) % len(coords)], point)
    else:
        distPrev = distance_between_points(coords[len(coords) - 1], point)
    if(distPrev < distNext):
        index2 = index1 - 1
    else:
        index2 = index1 + 1  
    return [index1, index2]

def get_distance_from_line(point1,point2,point0):
    #returns the distance of point 0 from the line between point 1 and 2
    x1, y1 = point1
    x2, y2 = point2
    x0, y0 = point0
    #got this equation off of wikipedia
    if(math.sqrt((x2 - x1)**2 + (y2 - y1)**2) == 0):
        return 0
    distance = abs((x2 - x1) * (y1 - y0) - (x1-x0) * (y2 - y1)) / math.sqrt((x2 - x1)**2 + (y2 - y1)**2)
    return distance

def diff_of_directions(heading, direction):
    #returns signed difference of direction between heading and direction
    #positive if counterclockwise
    #negative if clockwise
    direction_diff = abs(direction - heading)
    if direction_diff > 180:
        direction_diff = 360 - direction_diff
    return direction_diff

def reward_function(params):
    #*****Paste Map Data Here*****#
    raceline = [
        [-7.14731106, 0.484933341],
        [-7.01970241, 0.729024746],
        [-6.88473459, 0.960527949],
        [-6.74292039, 1.1786995],
        [-6.59477982, 1.38327096],
        [-6.44067102, 1.57400047],
        [-6.28075467, 1.75044072],
        [-6.11493121, 1.91170511],
        [-5.94306177, 2.05701423],
        [-5.76418572, 2.18366347],
        [-5.57715553, 2.28896626],
        [-5.37920529, 2.36775033],
        [-5.17217824, 2.42691853],
        [-4.95653485, 2.46927248],
        [-4.73247987, 2.4967004],
        [-4.50035636, 2.51102407],
        [-4.26019824, 2.51334556],
        [-4.01202388, 2.5046442],
        [-3.75587641, 2.48585106],
        [-3.49185274, 2.45789369],
        [-3.22008091, 2.42166243],
        [-2.94080026, 2.37807817],
        [-2.65436651, 2.32806213],
        [-2.3613479, 2.27257996],
        [-2.06284779, 2.21284555],
        [-1.7600271, 2.14993338],
        [-1.45435564, 2.08500755],
        [-1.14320338, 2.0199269],
        [-0.838660639, 1.9600118],
        [-0.545025099, 1.90840091],
        [-0.26553179, 1.86742261],
        [-0.00253887867, 1.83890403],
        [0.243852025, 1.82316446],
        [0.473863491, 1.82040854],
        [0.688203144, 1.83053662],
        [0.888117812, 1.85300797],
        [1.07449487, 1.88755691],
        [1.24866177, 1.933469],
        [1.41217388, 1.98970403],
        [1.56482707, 2.05691189],
        [1.70617151, 2.13613575],
        [1.83520804, 2.22929398],
        [1.95007234, 2.34029923],
        [2.0563628, 2.46385936],
        [2.1560492, 2.59898422],
        [2.25072313, 2.74569928],
        [2.34213622, 2.90459555],
        [2.43219922, 3.07677655],
        [2.52283442, 3.26402865],
        [2.61584992, 3.46806602],
        [2.73833076, 3.72077704],
        [2.86551277, 3.96301049],
        [2.99740433, 4.19360772],
        [3.1340635, 4.41104956],
        [3.2752234, 4.61445296],
        [3.42063632, 4.80261559],
        [3.56976281, 4.97511859],
        [3.72205446, 5.13140051],
        [3.87679411, 5.27166581],
        [4.03331928, 5.39575669],
        [4.19097573, 5.50211772],
        [4.34879163, 5.58890623],
        [4.50535548, 5.65425711],
        [4.65866975, 5.6961713],
        [4.80592239, 5.7127527],
        [4.94449249, 5.70490453],
        [5.07109077, 5.67247727],
        [5.18505216, 5.61961075],
        [5.28721779, 5.55034275],
        [5.3759447, 5.46448651],
        [5.44765319, 5.360224],
        [5.50388612, 5.24111567],
        [5.54523839, 5.10893316],
        [5.57275931, 4.96542695],
        [5.58731861, 4.81190199],
        [5.58978795, 4.64947846],
        [5.58180507, 4.47966648],
        [5.56539008, 4.30407514],
        [5.54290731, 4.12441469],
        [5.51714651, 3.94258461],
        [5.48682485, 3.723433],
        [5.46114659, 3.50805467],
        [5.4439224, 3.29966086],
        [5.43783626, 3.10072231],
        [5.44468728, 2.91317531],
        [5.46578553, 2.73876272],
        [5.50208735, 2.57918072],
        [5.55395753, 2.43584552],
        [5.62230954, 2.31119714],
        [5.70740258, 2.20757963],
        [5.81012103, 2.12905225],
        [5.92518173, 2.07013316],
        [6.0503763, 2.02854889],
        [6.18432126, 2.00288823],
        [6.32623765, 1.99250702],
        [6.47563524, 1.9970225],
        [6.63229729, 2.01621149],
        [6.79634423, 2.04998926],
        [6.96809536, 2.09803667],
        [7.14793373, 2.15976952],
        [7.33776798, 2.21289838],
        [7.52403035, 2.25138251],
        [7.70538264, 2.27363059],
        [7.88053122, 2.27859175],
        [8.04780663, 2.26476353],
        [8.20512243, 2.23055752],
        [8.35007047, 2.17468971],
        [8.47823738, 2.09407727],
        [8.58164274, 1.98437968],
        [8.66300321, 1.85382762],
        [8.71727461, 1.70213196],
        [8.73854524, 1.53050453],
        [8.72821556, 1.34490231],
        [8.68639298, 1.14955725],
        [8.61297536, 0.948304342],
        [8.50856529, 0.744934991],
        [8.37440218, 0.543033547],
        [8.21226691, 0.345842861],
        [8.02443415, 0.156123566],
        [7.81375891, -0.0240614262],
        [7.58271322, -0.193021452],
        [7.33370688, -0.349474517],
        [7.0691021, -0.492542908],
        [6.79116295, -0.621726263],
        [6.50200984, -0.736865028],
        [6.20358761, -0.838099069],
        [5.89764879, -0.925824332],
        [5.58575511, -1.00064923],
        [5.26930286, -1.06335167],
        [4.94957875, -1.11483778],
        [4.62784601, -1.15610479],
        [4.30544085, -1.18821139],
        [3.98383341, -1.21225803],
        [3.66460775, -1.22937641],
        [3.34940425, -1.24072171],
        [3.04007527, -1.24745691],
        [2.73942492, -1.2507217],
        [2.45233463, -1.25158534],
        [2.18660758, -1.2509698],
        [1.94757768, -1.24968485],
        [1.73487768, -1.24791904],
        [1.53198167, -1.24537054],
        [1.33277365, -1.24167106],
        [1.13497833, -1.23650476],
        [0.937730922, -1.22950899],
        [0.74056768, -1.22035849],
        [0.543165479, -1.20862839],
        [0.345228368, -1.1938431],
        [0.14646825, -1.17550055],
        [-0.053376789, -1.15315833],
        [-0.254523069, -1.12647632],
        [-0.45712571, -1.09524613],
        [-0.661266704, -1.05941822],
        [-0.866944983, -1.01912998],
        [-1.07406414, -0.974743939],
        [-1.28240997, -0.926915669],
        [-1.49175865, -0.876299106],
        [-1.70194491, -0.823369851],
        [-1.91293321, -0.768240369],
        [-2.12799931, -0.714201828],
        [-2.34025706, -0.664871052],
        [-2.54845656, -0.622289884],
        [-2.75146957, -0.588254079],
        [-2.94849502, -0.563981592],
        [-3.1387557, -0.550617363],
        [-3.32170924, -0.548898407],
        [-3.49692705, -0.559362595],
        [-3.66406143, -0.582409691],
        [-3.8228285, -0.618333478],
        [-3.97300595, -0.667327121],
        [-4.11443748, -0.729473744],
        [-4.24703212, -0.804740675],
        [-4.37075626, -0.892980762],
        [-4.48562295, -0.993935286],
        [-4.59168159, -1.10723545],
        [-4.68900907, -1.23240348],
        [-4.77770268, -1.36885564],
        [-4.85787587, -1.51590864],
        [-4.92965771, -1.67279029],
        [-4.9931969, -1.83865447],
        [-5.04866959, -2.01260034],
        [-5.09628939, -2.19369528],
        [-5.13631704, -2.38100069],
        [-5.16907034, -2.57359802],
        [-5.19494317, -2.7706101],
        [-5.21444908, -2.97121103],
        [-5.22828755, -3.17462505],
        [-5.23742726, -3.38011145],
        [-5.2426547, -3.58714495],
        [-5.24479381, -3.79528265],
        [-5.24430635, -4.00427267],
        [-5.24553528, -4.17814325],
        [-5.24978943, -4.34852232],
        [-5.2583931, -4.51403523],
        [-5.2727192, -4.67339465],
        [-5.29393371, -4.82568294],
        [-5.32322444, -4.97006475],
        [-5.36185938, -5.10564012],
        [-5.41098178, -5.23146896],
        [-5.47175609, -5.34624873],
        [-5.5455441, -5.44801324],
        [-5.63413131, -5.53371194],
        [-5.74055684, -5.59734066],
        [-5.8627368, -5.63747884],
        [-5.99712011, -5.65485471],
        [-6.14063237, -5.65006596],
        [-6.29054251, -5.62325601],
        [-6.44412305, -5.57461539],
        [-6.59871018, -5.50533093],
        [-6.75205442, -5.41660249],
        [-6.9023804, -5.31000401],
        [-7.04838726, -5.18714731],
        [-7.18902779, -5.04922285],
        [-7.32290363, -4.8962311],
        [-7.4483283, -4.72793086],
        [-7.56269225, -4.54319378],
        [-7.6610977, -4.33948747],
        [-7.74364123, -4.12037352],
        [-7.81071137, -3.88824443],
        [-7.86305079, -3.64508572],
        [-7.90106487, -3.39228951],
        [-7.92531783, -3.13116863],
        [-7.93597035, -2.8626967],
        [-7.93329504, -2.58790531],
        [-7.91765909, -2.30788821],
        [-7.88949327, -2.02379939],
        [-7.84925499, -1.73685644],
        [-7.79702835, -1.44834778],
        [-7.73364076, -1.15976075],
        [-7.65957486, -0.872595576],
        [-7.57534829, -0.588441554],
        [-7.48148658, -0.308954079],
        [-7.37850147, -0.0358278095],
        [-7.26687675, 0.229235666],
        [-7.14731106, 0.484933341]]
    speeds = [
        2.894987373062093,
        2.7161490314821473,
        2.4143887536892237,
        2.1740121979930795,
        1.8955585321511756,
        1.8955585321511756,
        1.8955585321511756,
        1.8955585321511756,
        1.8955585321511756,
        1.8955585321511756,
        2.1913139793333243,
        2.407975615416346,
        2.63626184204269,
        2.9271888196679257,
        3.199360704343075,
        3.505956018190557,
        3.857711860729073,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        3.6071437591524127,
        3.2181460010058123,
        2.9069727864874872,
        2.688566670821164,
        2.4822406027818276,
        2.3636565079322445,
        2.3247806722017907,
        2.139914095288202,
        1.9619469730878696,
        1.7774106737103097,
        1.5845348817197276,
        1.5845348817197276,
        1.5845348817197276,
        1.5845348817197276,
        1.5845348817197276,
        1.5845348817197276,
        1.9860630809082986,
        2.231152577246339,
        2.482294129053849,
        2.810086764041596,
        3.253948356149625,
        3.7609207855043105,
        3.5286178376567388,
        3.264169283370224,
        3.0895959401144384,
        2.901912223265862,
        2.7849371304213113,
        2.638390740729223,
        2.3898377865015537,
        2.1433716150734505,
        1.9147949742789359,
        1.6963361041325244,
        1.4950581143723902,
        1.3841646180447489,
        1.2504964666150522,
        1.2504964666150522,
        1.2504964666150522,
        1.2504964666150522,
        1.188728466234982,
        1.188728466234982,
        1.188728466234982,
        1.188728466234982,
        1.188728466234982,
        1.188728466234982,
        1.3425085388918656,
        1.4853471176831046,
        1.6784368443039197,
        1.8870048619026998,
        2.1191280842952827,
        2.4527465300350624,
        2.903083616255842,
        2.975077782354373,
        2.546566510959323,
        2.208031124324961,
        1.9229134540274848,
        1.6971046335749764,
        1.4659894177222834,
        1.2936466048820994,
        1.1349488589462955,
        1.1349488589462955,
        1.1349488589462955,
        1.1349488589462955,
        1.1349488589462955,
        1.1349488589462955,
        1.2740179865439947,
        1.3884712851066452,
        1.5161125557378823,
        1.6425884816076506,
        1.7834963487914668,
        1.942376020871138,
        2.1235013142754395,
        2.07284799708369,
        1.8668534596917898,
        1.6770975965088213,
        1.5219778522145853,
        1.336296845919599,
        1.1596154477687943,
        1.1596154477687943,
        1.1596154477687943,
        1.1596154477687943,
        1.1596154477687943,
        1.1596154477687943,
        1.288758004081844,
        1.288758004081844,
        1.3075161774429123,
        1.5031478457446592,
        1.6722175827642856,
        1.8319635393034206,
        2.0009396234942303,
        2.1738760721517245,
        2.3475024203657706,
        2.5240838638598198,
        2.718792252777504,
        2.8858352176209303,
        3.0446993691707824,
        3.2013936695665715,
        3.358507344509551,
        3.5186608563133106,
        3.684969437818962,
        3.8611716874785262,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        3.634548714206538,
        3.2327834445671906,
        2.889597220494872,
        2.6312382195671047,
        2.4170814663604174,
        2.2374179853177085,
        2.0889453152052204,
        1.971918793417692,
        1.8879037144835673,
        1.8378772565739165,
        1.8217824239069151,
        1.8217824239069151,
        1.8217824239069151,
        1.8217824239069151,
        1.8217824239069151,
        1.8217824239069151,
        1.8387375190424344,
        1.8871366649926697,
        1.9646141485054107,
        2.0680330198269337,
        2.1936376481150743,
        2.337330305020488,
        2.495121198530985,
        2.663590667702402,
        2.840325544199473,
        3.024187096018645,
        3.2160284059834057,
        3.421548085281111,
        3.6583440915676597,
        3.9654877928776493,
        4.0,
        3.7446242810004744,
        3.116928209640061,
        2.690779548582447,
        2.3424577061014684,
        2.046523049279893,
        1.812356843187433,
        1.612059631281452,
        1.4315992056402425,
        1.2673159842050812,
        1.1009951994583507,
        1.1009951994583507,
        1.1009951994583507,
        1.1009951994583507,
        1.1009951994583507,
        1.1009951994583507,
        1.1339826042869845,
        1.2553429322421523,
        1.3931830296370915,
        1.5230854512483734,
        1.649000840583232,
        1.8014849758632283,
        1.9440953478464071,
        2.0997067955440905,
        2.1876341536988315,
        2.1876341536988315,
        2.1876341536988315,
        2.1876341536988315,
        2.1876341536988315,
        2.1876341536988315,
        2.4027335163083903,
        2.6032785369555755,
        2.82246468476104,
        3.007139789930593,
        3.2074022931085118,
        3.3585972998213034,
        3.518523079128009,
        3.6833878138527893,
        3.846267765516221,
        3.9974219206854853,
        4.0,
        4.0,
        4.0,
        4.0,
        4.0,
        3.641061058411949,
        3.498489668053531,
        3.3844932133894035,
        3.2554717874919654,
        3.0966087086752427]
    steering_angles = [
        -1.6046855759720993,
        -1.7381790902152046,
        -1.8572820437753308,
        -2.0074747090210567,
        -2.218834911311554,
        -2.5388548896479755,
        -2.884465638435043,
        -3.651478271213698,
        -4.505186300957908,
        -5.930488249262525,
        -4.434181731446783,
        -3.670980687845477,
        -3.0620957563721274,
        -2.4832680180577675,
        -2.078537885070686,
        -1.730781400203856,
        -1.4294684599185432,
        -1.1677582077431592,
        -0.9472586129203434,
        -0.7564221638907673,
        -0.5955979862126661,
        -0.4577076637820084,
        -0.3255035986648727,
        -0.22594166693399145,
        -0.13542755509044466,
        0.09315689838978829,
        0.35905353812933943,
        0.6297922028307519,
        0.9251309202323444,
        1.2983870985969885,
        1.6350127246832427,
        2.054332159449217,
        2.517949196066259,
        2.9440053328895104,
        3.454335164663466,
        3.8101362061686013,
        3.93883013327896,
        4.650218062445419,
        5.534650297805124,
        6.748670135461565,
        8.503170421754525,
        5.400653464187343,
        4.276947843809492,
        3.4541860122959753,
        2.6946958511815544,
        2.009355636165363,
        1.4637433759983465,
        1.0086571714523977,
        -0.8826733345709055,
        -1.0971598680375327,
        -1.2646380135022337,
        -1.5040095684193038,
        -1.7086150016114403,
        -1.9967866461471024,
        -2.2289240495357276,
        -2.526744507684907,
        -2.7436220784479883,
        -3.057151486725637,
        -3.726992862378701,
        -4.635194583069583,
        -5.811516395094405,
        -7.412718611285354,
        -9.560712362344308,
        -11.172994959627001,
        -13.733807862599239,
        -13.653595473798687,
        -12.338752607594355,
        -13.364229104874223,
        -15.231806160371713,
        -11.887075917152137,
        -9.687335161826166,
        -7.572585731697851,
        -5.984571069376344,
        -4.742099033047773,
        -3.538015968961502,
        -2.5247045173902336,
        -1.6548901283065616,
        -0.8422301654676828,
        0.15186821679710819,
        0.812283377580306,
        1.6067581399835098,
        2.403919220569815,
        3.281833548840727,
        4.3671621185775855,
        5.762381422884765,
        7.4059688199864215,
        9.947441609128362,
        12.816986986859792,
        16.7510135022833,
        13.222071711097401,
        11.102908849551817,
        9.294642632951783,
        7.908817858612073,
        6.702481256087129,
        5.647104739703362,
        4.722542581134085,
        3.813371434784243,
        2.9712767787351604,
        -2.8216256319009743,
        -3.37652357816738,
        -4.143720447882773,
        -4.956738911389521,
        -6.11495717187983,
        -7.5847558671263755,
        -9.222516063828676,
        -11.999485867125115,
        -16.026519284054306,
        -12.40334294649766,
        -12.916085629779806,
        -12.542060190943067,
        -9.457132864458323,
        -7.629352591386384,
        -6.351044689001424,
        -5.320414159837644,
        -4.505751704658539,
        -3.862834043269808,
        -3.3406241999017228,
        -2.87885505854693,
        -2.554994570539151,
        -2.295178234778871,
        -2.0758977198560165,
        -1.886144375367869,
        -1.7183015353947753,
        -1.5666624457290952,
        -1.4269073095796239,
        -1.2958068748084899,
        -1.1710841014231528,
        -1.0513686442080226,
        -0.9361448906359527,
        -0.8256002601615796,
        -0.7202124377278932,
        -0.619996112608387,
        -0.5238394855027031,
        -0.4299509660534676,
        -0.33817424455355344,
        -0.25253996927815614,
        -0.18211543098166202,
        -0.11459324893923964,
        -0.12247005949145,
        -0.19372007844959596,
        -0.2825112625833403,
        -0.35923104745155615,
        -0.4467537172544496,
        -0.523309134338618,
        -0.6208909635414599,
        -0.7256027825814786,
        -0.8295624728937843,
        -0.9112627984049126,
        -0.9615333429602687,
        -0.9762915409844547,
        -0.9537633112723743,
        -0.8933345762087688,
        -0.793187612648942,
        -0.6461304854885244,
        -0.5100338820101892,
        -0.41405611712759355,
        -0.3863983229407225,
        0.40447945461519297,
        0.7660439909079393,
        1.1692751986184715,
        1.6104427570671984,
        2.035763155517119,
        2.548341749041951,
        3.073810589559878,
        3.6433360663529966,
        4.252983882539815,
        4.880454405114216,
        5.4786436747498914,
        5.978853000447205,
        6.310072748163776,
        6.422527227723149,
        6.304145783416071,
        5.983732086365162,
        5.5195860366344665,
        4.9799054459424585,
        4.424773927931095,
        3.896581309769255,
        3.418720007541525,
        2.9995252442255893,
        2.637583744121957,
        2.326436082163513,
        2.057039564149682,
        1.8172581138103332,
        1.58955552987755,
        1.3528081543873829,
        1.0838468590712753,
        0.8797079174501108,
        0.6815000765139977,
        0.5715531174481582,
        -0.4642373787894595,
        -0.982770707865644,
        -1.5171319262466825,
        -2.189985545259009,
        -2.939160812670538,
        -3.879515394873263,
        -5.085412437927911,
        -6.489791020099805,
        -8.21325444293538,
        -10.43639220996054,
        -13.364872370984619,
        -17.834210959879236,
        -16.78041716473795,
        -13.62591918108479,
        -11.02699285723002,
        -9.20899082213598,
        -7.847040195370134,
        -6.568702417356247,
        -5.637088369032856,
        -4.830436526110577,
        -4.170522803795581,
        -3.714056917682626,
        -3.605047658515305,
        -3.589450345150973,
        -3.814039980583123,
        -4.449141807679729,
        -3.687038410811977,
        -3.140257563836453,
        -2.671095320745152,
        -2.352902512534243,
        -2.068123809179013,
        -1.886043304755251,
        -1.7184361477816907,
        -1.5680085008493514,
        -1.4379893127472616,
        -1.331276277874608,
        -1.2896505623145385,
        -1.1926528219243282,
        -1.1562922439026584,
        -1.139753646658465,
        -1.1462043300280176,
        -1.1786845707222418,
        -1.240101853327332,
        -1.2878235237573705,
        -0.009463266929570712,
        -0.009463266929570712]
    #*****************************#

    #***** Defining Params *****#
    all_wheels_on_track = params["all_wheels_on_track"]
    car_x = params["x"]
    car_y = params["y"]
    #closest_waypoints = params["closest_waypoints"]
    #distance_from_center = params["distance_from_center"]
    #is_left_of_center = params["is_left_of_center"]
    #heading = params["heading"]
    progress = params["progress"]
    speed = params["speed"]
    steering_angle = params["steering_angle"]
    steps = params["steps"]
    #track_length = params["track_length"]
    track_width = params["track_width"]
    #waypoints = params["waypoints"]
    closest_raceline_waypoints = get_closest_waypoints(raceline, [car_x, car_y])
    distance_from_raceline = get_distance_from_line(raceline[closest_raceline_waypoints[0]],
                                                    raceline[closest_raceline_waypoints[1]],
                                                    [car_x, car_y])
    #direction_of_raceline = get_direction(raceline[closest_raceline_waypoints[0]],
    #                                      raceline[closest_raceline_waypoints[1]])
    #***************************#

    #***** AI Punishments *****#
    if not all_wheels_on_track:
        bad = 1e-3
        return bad
    #**************************#

    #AI REINFORCEMENT
    expected_steps = 2700
    raceline_points = 5
    steering_angle_points = 5
    speed_points = 5
    degree_goal = 3 # how quickly you penalize points for being off from steering angle
    speed_goal = .15
    reward = 0

    raceline_reward = ((track_width - distance_from_raceline) / track_width) * raceline_points

    avg_steering_angle = (steering_angles[closest_raceline_waypoints[0]] + steering_angles[closest_raceline_waypoints[1]]) / 2
    steering_reward = (((30 / degree_goal) - (abs(diff_of_directions(steering_angle, avg_steering_angle)) / degree_goal)) / (30 / degree_goal)) * steering_angle_points

    avg_speed = (speeds[closest_raceline_waypoints[0]] + speeds[closest_raceline_waypoints[1]]) / 2
    speed_reward = speed_points - (abs(avg_speed - speed) / speed_goal)

    print(raceline_reward, steering_reward, speed_reward)
    if(raceline_reward > 0):
        reward += raceline_reward
    if(steering_reward > 0):
        reward += steering_reward
    if(speed_reward > 0):
        reward += speed_reward
    
    #may prioritize speed because of this, going to run a test
    if(steps > 0):
        if((steps / expected_steps) < (progress / 100)):
            reward *= math.sqrt((progress / 100) / (steps / expected_steps))

    return reward